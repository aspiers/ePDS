# ============================================================================
# pds-core — Environment Variables
# ============================================================================
#
# How env vars are loaded depends on context:
#
#   Railway:          Set these per-service in the Railway dashboard.
#                     Use shared variable groups for vars marked [shared].
#   docker-compose:   All vars come from the top-level .env file.
#   pnpm dev:         dotenv.config() loads the top-level .env file.
#
# Vars marked [shared] MUST have the same value in pds-core and auth-service.

# -- Shared with auth-service --

# [shared] Your PDS domain (handles will be <random>.PDS_HOSTNAME)
PDS_HOSTNAME=pds.example

# [shared] Public URL of the PDS (used as OAuth issuer)
PDS_PUBLIC_URL=https://pds.example

# [shared] HMAC secret for signing /oauth/magic-callback redirects.
# MUST match auth-service. Generate with: openssl rand -hex 32
MAGIC_CALLBACK_SECRET=

# [shared] Secret for internal service-to-service calls (auth → pds).
# MUST match auth-service. Generate with: openssl rand -hex 32
MAGIC_INTERNAL_SECRET=

# [shared] PDS admin password (auth-service uses it for account provisioning).
# Generate with: openssl rand -hex 32
PDS_ADMIN_PASSWORD=

# [shared] Set to 'development' for dev mode (disables secure cookies, etc.)
# NODE_ENV=development

# -- PDS-core only --

PDS_PORT=3000
PDS_DATA_DIRECTORY=/data

# AT Protocol network settings
PDS_DID_PLC_URL=https://plc.directory
PDS_BSKY_APP_VIEW_URL=https://api.bsky.app
PDS_BSKY_APP_VIEW_DID=did:web:api.bsky.app
PDS_CRAWLERS=https://bsky.network

# PDS secrets (generate with: openssl rand -hex 32)
PDS_JWT_SECRET=
PDS_DPOP_SECRET=

# PLC rotation key (secp256k1 private key as hex)
# Generate with:
#   openssl ecparam -name secp256k1 -genkey -noout | openssl ec -text -noout 2>/dev/null | grep priv -A 3 | tail -n +2 | tr -d '[:space:]:'
PDS_PLC_ROTATION_KEY_K256_PRIVATE_KEY_HEX=

# Invite code for account creation (if PDS_INVITE_REQUIRED=true)
# Generate via the PDS admin API — see docs/deployment.md
# MAGIC_INVITE_CODE=

# PDS email (used by @atproto/pds for password reset, confirm-email, etc.)
# SMTP URL in the form smtp://user:pass@host:port or smtps://user:pass@host:465
PDS_EMAIL_SMTP_URL=smtp://localhost:1025
PDS_EMAIL_FROM_ADDRESS=noreply@pds.example

# Optional: contact address shown in PDS well-known metadata
# PDS_CONTACT_EMAIL_ADDRESS=

# Optional: separate SMTP credentials + address for moderation reports
# PDS_MODERATION_EMAIL_SMTP_URL=
# PDS_MODERATION_EMAIL_ADDRESS=

# Blobstore — where to store uploaded blobs (images, etc.)
PDS_BLOBSTORE_DISK_LOCATION=/data/blobs
