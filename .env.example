# ============================================================================
# ePDS — Shared Environment Variables
# ============================================================================
#
# This file contains variables shared across multiple services, plus
# service-specific vars for convenience when running with docker-compose
# (which loads this single file for both core and auth).
#
# For the authoritative list of what each service reads, see:
#   packages/pds-core/.env.example
#   packages/auth-service/.env.example
#   packages/demo/.env.example
#
# How env vars work in each context:
#
#   docker-compose:   Loads this file via env_file for core, auth, and caddy.
#                     Each container gets ALL vars; services ignore what they
#                     don't read.
#
#   Railway:          This file is NOT used. Set vars per-service in the
#                     Railway dashboard. Use shared variable groups for vars
#                     that must match across services (marked [shared] in the
#                     per-package .env.example files).
#
#   pnpm dev:         pds-core calls dotenv.config() which loads this file.
#                     Auth-service inherits the same process environment.
#
# For local development (docker-compose or pnpm dev), run:
#   ./scripts/setup.sh
# to copy this file to .env and auto-generate all secrets. Not needed for
# Railway (set vars in the dashboard instead).

# ============================================================================
# Shared — MUST match in pds-core and auth-service
# ============================================================================

# Your PDS domain (handles will be <random>.PDS_HOSTNAME)
PDS_HOSTNAME=pds.example

# Public URL of the PDS (used as OAuth issuer)
PDS_PUBLIC_URL=https://pds.example

# HMAC secret for signing /oauth/epds-callback redirects.
# Generate with: openssl rand -hex 32
EPDS_CALLBACK_SECRET=

# Secret for internal service-to-service calls (auth → pds).
# Generate with: openssl rand -hex 32
EPDS_INTERNAL_SECRET=

# PDS admin password (also used by auth-service for account provisioning).
# Generate with: openssl rand -hex 32
PDS_ADMIN_PASSWORD=

# Set to 'development' for dev mode (disables secure cookies, etc.)
# NODE_ENV=development

# ============================================================================
# pds-core only — see packages/pds-core/.env.example for full docs
# ============================================================================

PDS_PORT=3000
PDS_DATA_DIRECTORY=/data

PDS_DID_PLC_URL=https://plc.directory
PDS_BSKY_APP_VIEW_URL=https://api.bsky.app
PDS_BSKY_APP_VIEW_DID=did:web:api.bsky.app
PDS_CRAWLERS=https://bsky.network

PDS_JWT_SECRET=
PDS_DPOP_SECRET=

# Generate with:
#   openssl ecparam -name secp256k1 -genkey -noout | openssl ec -text -noout 2>/dev/null | grep priv -A 3 | tail -n +2 | tr -d '[:space:]:'
PDS_PLC_ROTATION_KEY_K256_PRIVATE_KEY_HEX=

PDS_EMAIL_SMTP_URL=smtp://localhost:1025
PDS_EMAIL_FROM_ADDRESS=noreply@pds.example
PDS_BLOBSTORE_DISK_LOCATION=/data/blobs

# ============================================================================
# auth-service only — see packages/auth-service/.env.example for full docs
# ============================================================================

AUTH_HOSTNAME=auth.pds.example
AUTH_PORT=3001
AUTH_SESSION_SECRET=
AUTH_CSRF_SECRET=

EPDS_LINK_EXPIRY_MINUTES=10
EPDS_LINK_BASE_URL=https://auth.pds.example/auth/verify

SESSION_EXPIRES_IN=604800
SESSION_UPDATE_AGE=86400

# GOOGLE_CLIENT_ID=
# GOOGLE_CLIENT_SECRET=
# GITHUB_CLIENT_ID=
# GITHUB_CLIENT_SECRET=

EMAIL_PROVIDER=smtp
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USER=
SMTP_PASS=
SMTP_FROM=noreply@pds.example
SMTP_FROM_NAME=ePDS

DB_LOCATION=/data/epds.sqlite

# ============================================================================
# Docker/Caddy only
# ============================================================================

# Override reverse proxy upstreams (for non-Docker or custom setups)
# PDS_UPSTREAM=core:3000
# AUTH_UPSTREAM=auth:3001
